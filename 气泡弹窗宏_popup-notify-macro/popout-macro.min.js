// popout-macro.min.js, for SugarCube 2, by RyaraSUKI v1.0.3
(()=>{let $topContainer=$('<div id="popout-container" class="top"></div>'),$bottomContainer=$('<div id="popout-container" class="bottom"></div>'),$sideContainer=($(document.body).append($topContainer,$bottomContainer),$('<div id="notify-container"></div>')),notifyQueue=($(document.body).append($sideContainer),[]),isNotifying=!1;function createPopout(message,duration,position,clickScript){var $container="bottom"===position?$bottomContainer:$topContainer;let $item=$('<div class="popout-item"></div>').wiki(message);clickScript&&$item.on("click",()=>{try{Scripting.evalJavaScript(clickScript)}catch(e){console.error("[Popout Error] 气泡弹窗点击代码执行错误：",e)}}),$container.append($item),"bottom"===position?$item.hide().slideDown(300,()=>$item.addClass("show")):($item[0].offsetWidth,$item.addClass("show")),setTimeout(()=>{$item.removeClass("show"),setTimeout(()=>{$item.slideUp(300,()=>$item.remove())},300)},duration)}function processQueue(){if(0===notifyQueue.length)isNotifying=!1;else{isNotifying=!0;let ev=notifyQueue.shift();var classList=Array.isArray(ev.class)?ev.class.join(" "):"string"==typeof ev.class?ev.class:"";let $item=$('<div class="notify-item"></div>').addClass(classList).wiki(ev.message);ev.clickScript&&$item.on("click",()=>{try{Scripting.evalJavaScript(ev.clickScript)}catch(e){console.error("[Popout (side/notify) Error] 气泡弹窗(side/notify)点击代码执行错误：",e)}}),$sideContainer.append($item),$item[0].offsetWidth,setTimeout(()=>$item.addClass("open"),20),setTimeout(()=>{$item.addClass("close"),setTimeout(()=>{$item.slideUp(300,()=>$item.remove())},500)},ev.duration||2e3),setTimeout(processQueue,150)}}function notify(message,duration,classes,clickScript){"string"==typeof message&&$(document).trigger({type:":notify",message:message.trim(),duration:"number"==typeof duration?duration:2e3,class:classes||"",clickScript:clickScript})}$(document).on(":notify",ev=>{ev.message&&"string"==typeof ev.message&&(notifyQueue.push(ev),isNotifying||processQueue())}),Macro.add("popout",{tags:null,handler(){var arg,message=this.payload[0].contents.trim();let duration=2e3,position="top",clickScript="";for(arg of this.args)"number"==typeof arg?duration=arg:"top"===arg||"bottom"===arg||"side"===arg?position=arg:"string"==typeof arg&&(clickScript=arg);message&&("side"===position?notify(message,duration,"",clickScript):createPopout(message,duration,position,clickScript))}}),Macro.add("notify",{tags:null,handler(){var message=this.payload[0].contents.trim();let duration=2e3,classes="";0<this.args.length&&(classes=("number"==typeof this.args[0]?(duration=this.args[0],this.args.slice(1)):this.args).join(" ")),notify(message,duration,classes,"")}}),setup.notify=notify,setup.popout=(message,duration,position="top",clickScript="")=>{"side"===position?notify(message,duration,"",clickScript):createPopout(message,duration,position,clickScript)}})();
// end popout-macro.min.js